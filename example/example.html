<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<title>Example for js-hypercube</title>
	<meta name="description" content="JsHypercube is a light-weight OLAP database written in JavaScript. It is useful for any application involving the aggregation of metrics for purposes of dynamic charting.">
    <link rel="stylesheet" type="text/css" href="http://datatables.net/release-datatables/media/css/demo_table.css">
</head>
<body>
	<header>

	</header>
	<section>
        <div id="log"></div>
        <div id="table">
            <table class="display" id="example"></table>
        </div>
        <div id="chart_multiple_series" style="min-width: 310px; height: 400px; margin: 0 auto; clear: both"></div>
        <div id="multiple_charts"></div>
	</section>
	<footer>

	</footer>


	<!-- Requires jQuery, but you could easily replace jQuery if you create $.each, $.map, $.extend, $.isArray, $.isPlainObject, $.isFunction -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script src="plugins.js"></script>

	<!-- Typically, you would use the minified version -->
	<script src="../src/ps.js"></script>
	<script src="../src/ps.array.js"></script>
	<script src="../src/ps.object.js"></script>
	<script src="../src/ps.FactIndex.js"></script>
	<script src="../src/ps.Cell.js"></script>
	<script src="../src/ps.Cube.js"></script>
	<script src="./ps.Cube.extension.js"></script>

    <!--Reports Classes-->
	<script src="ReportsCollection.class.js"></script>
	<script src="ReportsBuilder.class.js"></script>
	<!--<script src="../src/ps.Cube.transforms.js"></script>-->
	<!--<script src="../js-hypercube.min.js"></script>-->
    <script src="http://code.highcharts.com/highcharts.js"></script>

    <!--Datatables-->
    <script type="text/javascript" language="javascript" src="http://datatables.net/release-datatables/media/js/jquery.dataTables.js"></script>

	<script>
        builder = new ReportsBuilder();
        var reports_collection = builder.getReportsCollection();

        //backguards compatibility
        var reports = function(key) {
            key = key || 'main';
            return reports_collection.getReport(key);
        };
        
        function print(title, content){
            $('#log').append('<p>'+ title + ':' +JSON.stringify(content)+'</p>');

        };

        // run some interesting queries
        var key = 'main';
		print('Total Visits', reports(key).getFactValues('date'));
	</script>

    <!--HIGHCHARTS INITIALIZATION-->
    <script>
        var _series = [];
        $(function () {
            reports(key).getFactValues('country').forEach(function(value){
                var temp = {};
                temp.name = value;
                temp.data = reports(key).slice( { country: value }).extractMeasureValues('visits');
                _series.push(temp);
            });

//            ONE WITH MULTIPLE SERIES
            $('#chart_multiple_series').highcharts({
                xAxis: {
                    categories: reports(key).getFactValues('date')
                },
                yAxis: {
                    title: {
                        text: 'visits'
                    }
                },
                series: _series
            });

//            MULTIPLE CHARTS
            reports(key).getFactValues('country').forEach(function(value){
                var div = $('<div/>');
                $(div).appendTo('#multiple_charts');

                div.highcharts({
                    xAxis: {
                        categories: reports(key).getFactValues('date')
                    },
                    yAxis: {
                        title: {
                            text: 'visits'
                        }
                    },
                    series: [
                        {
                            name: value,
                            data: reports(key).slice( { country: value }).extractMeasureValues('visits')
                        }
                    ]
                });
            });

        });

    </script>

    <!--DATATABLES INITIALIZATION-->
    <script type="text/javascript" charset="utf-8">
        $(document).ready(function() {
            $('#example').dataTable( {
                "aaData": reports_collection.getReport(key).exportDataToTable(),
                "aoColumns": reports_collection.getReport(key).exportHeadersToDataTables()
            } );
        } );
    </script>
</body>
</html>